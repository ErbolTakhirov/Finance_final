{% extends 'base.html' %}
{% block title %}–ó–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ - FinBilim 2025{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="teen-card p-4">
            <h1 class="h2 mb-2"><i class="bi bi-shield-check me-2"></i>–ó–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞</h1>
            <p class="text-muted mb-0">–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –æ–±–º–∞–Ω.</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-7 mb-4">
        <div class="teen-card p-4">
            <h3 class="h5 mb-3">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
            <p class="text-muted small">–ü—Ä–∏—Å–ª–∞–ª–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram –∏–ª–∏ WhatsApp? –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç —Å—é–¥–∞, –∏ –Ω–∞—à AI –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —É–≥—Ä–æ–∑.</p>
            
            <form id="scamCheckForm">
                <div class="mb-3">
                    <textarea class="form-control" id="scamText" rows="6" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∑–¥–µ—Å—å..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100" id="checkButton">
                    <i class="bi bi-search me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ
                </button>
            </form>
            
            <div id="scamResult" class="mt-4 d-none">
                <div class="alert" id="resultAlert">
                    <h5 id="resultTitle"></h5>
                    <p id="resultExplanation" class="mb-0"></p>
                </div>
                <div id="redFlags" class="mt-3 d-none">
                    <h6>üö© –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏:</h6>
                    <ul id="flagsList"></ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-5 mb-4">
        <div class="teen-card p-4">
            <h3 class="h5 mb-3">–¢–æ–ø —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
            <div class="list-group list-group-flush">
                <div class="list-group-item px-0">
                    <h6 class="mb-1">–ù–∏–∫–æ–º—É –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç–µ SMS-–∫–æ–¥—ã</h6>
                    <p class="text-muted small mb-0">–î–∞–∂–µ –µ—Å–ª–∏ –∑–≤–æ–Ω—è—Ç –∏–∑ "–±–∞–Ω–∫–∞" –∏–ª–∏ "–ø–æ–ª–∏—Ü–∏–∏".</p>
                </div>
                <div class="list-group-item px-0">
                    <h6 class="mb-1">–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Å—ã–ª–∫–∏</h6>
                    <p class="text-muted small mb-0">–í—Å–µ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –¥–æ–º–µ–Ω –ø–µ—Ä–µ–¥ –≤–≤–æ–¥–æ–º –¥–∞–Ω–Ω—ã—Ö.</p>
                </div>
                <div class="list-group-item px-0">
                    <h6 class="mb-1">–°–ª–∏—à–∫–æ–º —Ö–æ—Ä–æ—à–æ, —á—Ç–æ–±—ã –±—ã—Ç—å –ø—Ä–∞–≤–¥–æ–π</h6>
                    <p class="text-muted small mb-0">–ï—Å–ª–∏ –æ–±–µ—â–∞—é—Ç 100% –ø—Ä–∏–±—ã–ª–∏ –∑–∞ –¥–µ–Ω—å - —ç—Ç–æ –æ–±–º–∞–Ω.</p>
                </div>
            </div>
            
            <div class="mt-4">
                <a href="{% url 'teen:learning' %}" class="btn btn-outline-primary w-100">
                    –ü—Ä–æ–π—Ç–∏ –∫—É—Ä—Å –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                </a>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('scamCheckForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const text = document.getElementById('scamText').value.trim();
    if (!text) return;
    
    const btn = document.getElementById('checkButton');
    const resultDiv = document.getElementById('scamResult');
    const resultAlert = document.getElementById('resultAlert');
    
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
    
    try {
        const response = await fetch('{% url "teen:api_scam_report" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({ text: text })
        });
        
        const data = await response.json();
        
        resultDiv.classList.remove('d-none');
        if (data.is_suspicious) {
            resultAlert.className = 'alert alert-danger';
            document.getElementById('resultTitle').textContent = '‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É–≥—Ä–æ–∑–∞!';
            document.getElementById('resultExplanation').textContent = data.explanation;
            
            if (data.red_flags && data.red_flags.length > 0) {
                const flagsList = document.getElementById('flagsList');
                flagsList.innerHTML = '';
                data.red_flags.forEach(flag => {
                    const li = document.createElement('li');
                    li.textContent = flag;
                    flagsList.appendChild(li);
                });
                document.getElementById('redFlags').classList.remove('d-none');
            }
        } else {
            resultAlert.className = 'alert alert-success';
            document.getElementById('resultTitle').textContent = '‚úÖ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
            document.getElementById('resultExplanation').textContent = '–ù–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.';
            document.getElementById('redFlags').classList.add('d-none');
        }
        
    } catch (error) {
        console.error('Error:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="bi bi-search me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ';
    }
});
</script>
{% endblock %}
