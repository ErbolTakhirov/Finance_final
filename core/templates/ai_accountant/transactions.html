{% extends "base.html" %}

{% block title %}Транзакции - AI Бухгалтер{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-md-8">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="app-section-title mb-0">История транзакций</h3>
            <div>
                <a href="{% url 'income_create' %}" class="btn btn-success btn-sm"><i class="bi bi-plus-lg"></i> Доход</a>
                <a href="{% url 'expense_create' %}" class="btn btn-danger btn-sm"><i class="bi bi-plus-lg"></i> Расход</a>
            </div>
        </div>
        <div class="app-card">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Дата</th>
                            <th>Категория</th>
                            <th>Сумма</th>
                            <th>Тип</th>
                            <th>Описание</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tx in transactions %}
                        <tr>
                            <td>{{ tx.date|date:"d.m.Y" }}</td>
                            <td>{{ tx.category }}</td>
                            <td class="fw-bold {% if tx.type == 'income' %}text-success{% else %}text-danger{% endif %}">
                                {{ tx.amount }}
                            </td>
                            <td>
                                {% if tx.type == 'income' %}
                                    <span class="badge bg-success-subtle text-success">Доход</span>
                                {% else %}
                                    <span class="badge bg-danger-subtle text-danger">Расход</span>
                                {% endif %}
                            </td>
                            <td class="small text-muted">{{ tx.description|truncatechars:30 }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-4 text-muted">Транзакций пока нет.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <h3 class="app-section-title mb-3">Итоги по месяцам</h3>
        <div class="app-card p-3">
            <div class="list-group list-group-flush">
                {% for summary in summaries %}
                <div class="list-group-item bg-transparent px-0">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="fw-bold">{{ summary.month_key }}</span>
                        <span class="badge {% if summary.profit >= 0 %}bg-success{% else %}bg-danger{% endif %}">
                            {{ summary.profit }}
                        </span>
                    </div>
                    <div class="d-flex justify-content-between small text-muted">
                        <span>Доходы: {{ summary.total_income }}</span>
                        <span>Расходы: {{ summary.total_expense }}</span>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted small">Данных для агрегации пока нет.</p>
                {% endfor %}
            </div>
        </div>
        
        <div class="app-card p-3 mt-4 bg-primary text-white">
            <h5><i class="bi bi-lightbulb"></i> AI Совет</h5>
            <p class="small mb-0">
                AI Бухгалтер анализирует эти данные для построения прогнозов. 
                Добавьте еще хотя бы 3 месяца истории, чтобы получить точный прогноз прибыли.
            </p>
        </div>
    </div>
</div>
{% endblock %}
