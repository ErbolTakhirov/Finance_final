# –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ ML —Å–∏—Å—Ç–µ–º—ã SB Finance

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ML](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-ml)
3. [–ü—Ä–æ—Ü–µ—Å—Å—ã –∏ —Ä–∞–±–æ—á–∏–µ –ø–æ—Ç–æ–∫–∏](#–ø—Ä–æ—Ü–µ—Å—Å—ã-–∏-—Ä–∞–±–æ—á–∏–µ-–ø–æ—Ç–æ–∫–∏)
4. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Django](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-django)
5. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## üèó –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

ML —Å–∏—Å—Ç–µ–º–∞ SB Finance –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `core` –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –º–æ–¥—É–ª–µ–π, –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/core/ml/`. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞—Å–ø–µ–∫—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:

```
core/
‚îú‚îÄ‚îÄ ml/
‚îÇ   ‚îú‚îÄ‚îÄ predictor.py              # –ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ (ML)
‚îÇ   ‚îú‚îÄ‚îÄ forecast.py               # –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ (Á∫øÊÄß —Ä–µ–≥—Ä–µ—Å—Å–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ recommender.py            # –ü—Ä–∞–≤–∏–ª–∞-–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ document_generator.py      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (Hugging Face)
‚îÇ   ‚îî‚îÄ‚îÄ train_classifier.py       # –û–±—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ analytics.py              # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ anonymizer.py             # –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è LLM
‚îÇ   ‚îú‚îÄ‚îÄ encryption.py             # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ export.py                 # –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ file_ingest.py            # –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤ (CSV, Excel, PDF)
‚îú‚îÄ‚îÄ llm.py                        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM (OpenRouter/Ollama)
‚îú‚îÄ‚îÄ models.py                     # –ú–æ–¥–µ–ª–∏ Django
‚îî‚îÄ‚îÄ views.py                      # API endpoints –∏ views
```

---

## üß† –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã ML

### 1. –ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ (Expense Auto-Categorizer)

**–§–∞–π–ª:** `core/ml/predictor.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏—è.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```python
class ExpenseAutoCategorizer:
    """
    –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π:
    1. ML –º–æ–¥–µ–ª—å (–µ—Å–ª–∏ –æ–±—É—á–µ–Ω–∞)
    2. Fallback: –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    """
```

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **ML –ü—É—Ç—å:**
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –∏–∑ `media/ml/expense_classifier.joblib`
   - –ú–æ–¥–µ–ª—å –æ–±—É—á–µ–Ω–∞ –Ω–∞ sklearn Pipeline: TF-IDF –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è
   - –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 'rent', 'tax', 'salary', 'marketing', 'purchase', 'other')

2. **Fallback –ü—É—Ç—å (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞):**
   - –ò—â–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ä–∞—Å—Ö–æ–¥–∞ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ)
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:
     - `rent`: '–∞—Ä–µ–Ω–¥–∞', '–æ—Ñ–∏—Å', '–ø–æ–º–µ—â'
     - `tax`: '–Ω–∞–ª–æ–≥', '–Ω–¥—Å', '—Ñ–Ω—Å'
     - `salary`: '–∑–∞—Ä–ø–ª–∞—Ç', '–æ–∫–ª–∞–¥'
     - `marketing`: '—Ä–µ–∫–ª–∞–º', '–º–∞—Ä–∫–µ—Ç'
     - `purchase`: '–∑–∞–∫—É–ø', '–ø–æ–∫—É–ø'
     - `other`: –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
from core.ml.predictor import ExpenseAutoCategorizer

categorizer = ExpenseAutoCategorizer()
category = categorizer.predict_category("–û–ø–ª–∞—Ç–∞ –∞—Ä–µ–Ω–¥—ã –æ—Ñ–∏—Å–∞ –∑–∞ –º–∞—Ä—Ç")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 'rent'
```

#### –¢–æ—á–Ω–æ—Å—Ç—å:

- ML –º–æ–¥–µ–ª—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç —Ö–æ—Ä–æ—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–∞—Ö (–¥–µ–º–æ-–Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)
- Fallback –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –º–æ–¥–µ–ª–∏

---

### 2. –û–±—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ (Training Script)

**–§–∞–π–ª:** `core/ml/train_classifier.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—É—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (Demo Data):**
   ```python
   [
       ('–û–ø–ª–∞—Ç–∞ –∞—Ä–µ–Ω–¥—ã –æ—Ñ–∏—Å–∞ –∑–∞ –º–∞—Ä—Ç', 'rent'),
       ('–ù–∞–ª–æ–≥–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂ –ù–î–°', 'tax'),
       ('–ó–∞—Ä–ø–ª–∞—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º –∑–∞ —Ñ–µ–≤—Ä–∞–ª—å', 'salary'),
       ('–ó–∞–ø—É—Å–∫ —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö', 'marketing'),
       ('–ó–∞–∫—É–ø–∫–∞ —Å—ã—Ä—å—è –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤', 'purchase'),
       ...
   ]
   ```

2. **Pipeline –º–æ–¥–µ–ª–∏:**
   - **TF-IDF Vectorizer**: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç –≤ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä–∞
     - –î–∏–∞–ø–∞–∑–æ–Ω n-–≥—Ä–∞–º–º: (1, 2) - —É–Ω–≥—Ä–∞–º–º—ã –∏ –±–∏–≥—Ä–∞–º–º—ã
     - min_df=1 - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
   
   - **–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è**: –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä
     - max_iter=1000 - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
   
3. **–û–±—É—á–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
   ```bash
   python core/ml/train_classifier.py
   ```
   - –†–∞–∑–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ: 80% –æ–±—É—á–µ–Ω–∏–µ, 20% —Ç–µ—Å—Ç
   - –û–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å
   - –í—ã–≤–æ–¥–∏—Ç classification report
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `media/ml/expense_classifier.joblib`

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
   ```python
   from core.ml.train_classifier import train
   train()
   ```

#### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:

- –ü–æ–ø–æ–ª–Ω—è—Ç—å –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–µ—Ä–µ–æ–±—É—á–∞—Ç—å –º–æ–¥–µ–ª—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—ã–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, RuBERT) –¥–ª—è –ª—É—á—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

---

### 3. –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ (Profit Forecasting)

**–§–∞–π–ª:** `core/ml/forecast.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:**
   - –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º
   - –í—ã—á–∏—Å–ª—è–µ—Ç –º–µ—Å—è—á–Ω—É—é –ø—Ä–∏–±—ã–ª—å: –¥–æ—Ö–æ–¥—ã - —Ä–∞—Å—Ö–æ–¥—ã
   - –°–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥

2. **–õ–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è:**
   ```python
   X = np.array(range(len(months))).reshape(-1, 1)  # –º–µ—Å—è—Ü—ã (0, 1, 2, ...)
   y = np.array(profits)                             # –ø—Ä–∏–±—ã–ª—å –∑–∞ –º–µ—Å—è—Ü—ã
   model = LinearRegression()
   model.fit(X, y)
   next_idx = len(months)
   forecast = model.predict([[next_idx]])
   ```

3. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
   - –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–∞—è –ø—Ä–∏–±—ã–ª—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü
   - –ò–ª–∏ `None` –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
from core.ml.forecast import forecast_next_month_profit

incomes = Income.objects.filter(user=user)
expenses = Expense.objects.filter(user=user)
forecast = forecast_next_month_profit(incomes, expenses)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 45230.75 (–ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏–±—ã–ª–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü)
```

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

- –õ–∏–Ω–µ–π–Ω–∞—è –º–æ–¥–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Ç—Ä–µ–Ω–¥–∞—Ö
- –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å
- –¢—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 2 –º–µ—Å—è—Ü–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–∏ –æ–¥–Ω–æ–º –º–µ—Å—è—Ü–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü

#### –£–ª—É—á—à–µ–Ω–∏—è:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ARIMA –∏–ª–∏ Prophet –¥–ª—è —É—á—ë—Ç–∞ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
- –î–æ–±–∞–≤–∏—Ç—å –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∫ –ø—Ä–æ–≥–Ω–æ–∑—É
- –£—á–∏—Ç—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –∏ –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã

---

### 4. –ü—Ä–∞–≤–∏–ª–∞-–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (Recommender)

**–§–∞–π–ª:** `core/ml/recommender.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–∞–≤–∏–ª–æ 1: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏**
   ```
   –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ > 40% –æ—Ç –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
   ‚Üí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: "–°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{category}'. 
                    –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∑–∞—Ç—Ä–∞—Ç."
   ```

2. **–ü—Ä–∞–≤–∏–ª–æ 2: –°–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤**
   ```
   –ï—Å–ª–∏ –µ—Å—Ç—å 6+ –º–µ—Å—è—Ü–µ–≤ –¥–∞–Ω–Ω—ã—Ö:
     —Å—Ä–µ–¥–Ω–∏–µ –¥–æ—Ö–æ–¥—ã –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3 –º–µ—Å—è—Ü–µ–≤ < 90% –æ—Ç —Å—Ä–µ–¥–Ω–∏—Ö –¥–æ—Ö–æ–¥–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö 3 –º–µ—Å—è—Ü–µ–≤
     ‚Üí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: "–ó–∞–º–µ—á–µ–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤. –£—Å–∏–ª—å—Ç–µ –ø—Ä–æ–¥–∞–∂–∏/–º–∞—Ä–∫–µ—Ç–∏–Ω–≥ 
                      –∏ –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ –≤–æ—Ä–æ–Ω–∫—É."
   ```

3. **–ü—Ä–∞–≤–∏–ª–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
   ```
   –ï—Å–ª–∏ –Ω–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –¥—Ä—É–≥–∏—Ö –ø—Ä–∞–≤–∏–ª
   ‚Üí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–µ–π—Å—Ç–≤—É—é—â–∏–µ 
                    –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥."
   ```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
from core.ml.recommender import build_recommendations

incomes = Income.objects.filter(user=user)
expenses = Expense.objects.filter(user=user)
recommendations = build_recommendations(incomes, expenses)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: ["–°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã...", "–ó–∞–º–µ—á–µ–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤..."]
```

#### –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:

–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é `build_recommendations()`:

```python
# –ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Ö–æ–¥–æ–≤
variance = np.var(expense_values)
if variance > threshold:
    recs.append("–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Ö–æ–¥–æ–≤. –¢—Ä–µ–±—É–µ—Ç—Å—è –±—é–¥–∂–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.")
```

---

### 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (Document Generator)

**–§–∞–π–ª:** `core/ml/document_generator.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Å—á–µ—Ç–∞, –∞–∫—Ç—ã, –¥–æ–≥–æ–≤–æ—Ä—ã) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LLM.

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

1. **–û—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å: Hugging Face Transformers**
   ```python
   Model: sshleifer/tiny-gpt2  # –º–∞–ª–µ–Ω—å–∫–∞—è –¥–µ–º–æ-–º–æ–¥–µ–ª—å
   Approach: –∫–∞—É–∑–∞–ª—å–Ω–∞—è —è–∑—ã–∫–æ–≤–∞—è –º–æ–¥–µ–ª—å (GPT-2)
   ```

2. **Fallback –ø—É—Ç—å: —à–∞–±–ª–æ–Ω—ã**
   ```python
   –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
   ‚Üí –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≥–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   ```

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞):**
   ```python
   def _lazy_load():
       # –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª—å –∏ —Ç–æ–∫–µ–Ω–∞–π–∑–µ—Ä —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
       # –≠–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å –∏ —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   ```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞:**
   ```python
   prompt = "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π {doc_type} –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ö–ª–∏–µ–Ω—Ç: {client}. –°—É–º–º–∞: {total}..."
   
   # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
   - max_new_tokens=80      # –º–∞–∫—Å. –Ω–æ–≤—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
   - do_sample=True         # —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
   - top_k=50               # top-k sampling
   - top_p=0.95             # nucleus sampling
   ```

3. **–¢–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
   - `invoice`: —Å—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É
   - `act`: –∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç
   - `contract`: –¥–æ–≥–æ–≤–æ—Ä

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
from core.ml.document_generator import generate_document_text

params = {
    'client': '–û–û–û –ö–æ–º–ø–∞–Ω–∏—è',
    'total': '50000',
    'details': '–£—Å–ª—É–≥–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è'
}

text = generate_document_text('invoice', params)
```

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –∑–∞–º–µ—á–∞–Ω–∏—è:

- `tiny-gpt2` - —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏, –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—Å—Ç–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ
- –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ –∏–ª–∏ API (GPT-4, Claude) —á–µ—Ä–µ–∑ `llm.py`
- –¢—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏

---

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π

**–§–∞–π–ª:** `core/utils/analytics.py` (~700 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

#### 1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π –≤ —Ä–∞—Å—Ö–æ–¥–∞—Ö

```python
def _detect_expense_anomalies(expense_events: List[Dict]) -> List[Dict]:
    """
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã:
    - –°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (mean)
    - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (stdev)
    - –ú–µ–¥–∏–∞–Ω–∞
    - Z-score
    
    –ü–æ—Ä–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: mean + 2*stdev –∏–ª–∏ median * 1.8
    """
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Å—É–º–º—ã —Ä–∞—Å—Ö–æ–¥–æ–≤
2. –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
3. –ï—Å–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ < 1e-6 (–ø–æ—á—Ç–∏ –≤—Å–µ —Å—É–º–º—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ):
   - –ü–æ—Ä–æ–≥ = —Å—Ä–µ–¥–Ω—è—è * 1.7
4. –ò–Ω–∞—á–µ:
   - –ü–æ—Ä–æ–≥ = max(mean + 2*stdev, median * 1.8)
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –ø–æ—Ä–æ–≥, —Å z-score

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```python
{
    'amount': 125000.0,
    'category': 'marketing',
    'date': '2024-01-15',
    'z_score': 2.45,
    'threshold': 75000.0,
    'mean': 35000.0
}
```

#### 2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –º–µ—Å—è—Ü–∞–º

```python
def aggregate_transactions_by_month(incomes_qs, expenses_qs) -> Dict:
    """
    –°–æ–±–∏—Ä–∞–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞:
    - –û–±—â–∏–µ –¥–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã
    - –ë–∞–ª–∞–Ω—Å (–¥–æ—Ö–æ–¥—ã - —Ä–∞—Å—Ö–æ–¥—ã)
    - –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
    - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    - % –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    """
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

```python
{
    '2024-01': {
        'income_total': 150000.0,
        'expense_total': 85000.0,
        'balance': 65000.0,
        'top_income_categories': [
            {'category': 'sales', 'amount': 120000.0},
            {'category': 'service', 'amount': 30000.0}
        ],
        'top_expense_categories': [
            {'category': 'marketing', 'amount': 40000.0},
            {'category': 'salary', 'amount': 35000.0}
        ],
        'average_check': 5833.33,
        'transaction_count': 26,
        'income_change_pct': 12.5,    # vs –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü
        'expense_change_pct': -5.2
    },
    '2024-02': { ... },
    ...
}
```

#### 3. –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤

```python
def _analyze_trends(ordered_keys, months) -> Dict:
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–µ–Ω–¥—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3+ –º–µ—Å—è—Ü–∞:
    - –¢—Ä–µ–Ω–¥ –¥–æ—Ö–æ–¥–æ–≤ (growth/decline/stable)
    - –¢—Ä–µ–Ω–¥ —Ä–∞—Å—Ö–æ–¥–æ–≤
    - –¢—Ä–µ–Ω–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ä–∞—Å—Ö–æ–¥–æ–≤
    """
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**

```python
{
    'has_enough_data': True,
    'income_trend': 'growth',        # –∏–ª–∏ 'decline', 'stable'
    'expense_trend': 'stable',
    'income_trend_pct': 8.5,         # % –∏–∑–º–µ–Ω–µ–Ω–∏—è
    'category_trends': {
        'marketing': {
            'trend': 'growth',
            'change_pct': 15.2,
            'values': [40000, 42000, 48000],
            'latest': 48000,
            'average': 43333.33
        },
        ...
    }
}
```

#### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Markdown —Ç–∞–±–ª–∏—Ü—ã

```python
def _build_table_markdown(ordered_keys, months) -> str:
```

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤—É—é —Ç–∞–±–ª–∏—Ü—É —Å –º–µ—Å—è—á–Ω—ã–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏:

```
| –ú–µ—Å—è—Ü | –î–æ—Ö–æ–¥—ã | –†–∞—Å—Ö–æ–¥—ã | –ë–∞–ª–∞–Ω—Å | –ö–∞—Ç–µ–≥. –¥–æ—Ö–æ–¥ | –ö–∞—Ç–µ–≥. —Ä–∞—Å—Ö–æ–¥ | –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –ò–∑–º. –¥–æ—Ö–æ–¥ | –ò–∑–º. —Ä–∞—Å—Ö–æ–¥ |
|---|---|---|---|---|---|---|---|---|---|
| 01.2024 | 150 000 | 85 000 | 65 000 | sales (120 000) | marketing (40 000) | 5 833 | 26 | ‚Äî | ‚Äî |
| 02.2024 | 168 500 | 80 500 | 88 000 | sales (135 000) | salary (35 000) | 6 077 | 28 | +12.3% | -5.3% |
```

#### 5. –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ

```python
def _build_text_summary(ordered_keys, months, anomalies) -> str:
```

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –≤—ã–≤–æ–¥–∞–º–∏:

```
"–í —è–Ω–≤–∞—Ä–µ 2024 —Ä–µ–∫–æ—Ä–¥ –ø–æ –¥–æ—Ö–æ–¥–∞–º ‚Äî 150 000 –∑–∞ —Å—á—ë—Ç sales. 
 –î–µ–∫–∞–±—Ä–µ 2023 ‚Äî –ø–∏–∫ —Ä–∞—Å—Ö–æ–¥–æ–≤ 95 000 (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏: marketing, salary).
 –î–æ—Ö–æ–¥—ã –ø—Ä–æ—Å–µ–ª–∏ –Ω–∞ 8.5% –≤ –¥–µ–∫–∞–±—Ä–µ 2023.
 –†–∞—Å—Ö–æ–¥—ã –≤—ã—Ä–æ—Å–ª–∏ –Ω–∞ 12.3% –≤ —è–Ω–≤–∞—Ä–µ 2024.
 –ê–Ω–æ–º–∞–ª–∏—è: 125 000 –Ω–∞ marketing (2024-01-15)."
```

#### 6. –û—Ü–µ–Ω–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è

```python
def assess_financial_health(incomes_qs, expenses_qs, anomalies) -> Dict:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ü–µ–Ω–∫—É –≤ –º–∞—Å—à—Ç–∞–±–µ 0-100:
    - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π (savings ratio)
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
    - –ù–∞–ª–∏—á–∏–µ –∞–Ω–æ–º–∞–ª–∏–π
    """
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ü–µ–Ω–∫–∏:**

1. **Savings Ratio:**
   - (–î–æ—Ö–æ–¥—ã - –†–∞—Å—Ö–æ–¥—ã) / –î–æ—Ö–æ–¥—ã
   - 75-100: –æ—Ç–ª–∏—á–Ω—ã–π (> 30% –ø—Ä–∏–±—ã–ª—å)
   - 50-75: —Ö–æ—Ä–æ—à–∏–π (15-30%)
   - 25-50: —Å—Ä–µ–¥–Ω–∏–π (0-15%)
   - 0-25: –ø–ª–æ—Ö–æ–π (< 0, —É–±—ã—Ç–æ–∫)

2. **–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
   - –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–æ—Ö–æ–¥–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç –æ—Ü–µ–Ω–∫—É
   - –£–º–µ—Ä–µ–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–æ—Ä–º–∞–ª—å–Ω–∞

3. **–ê–Ω–æ–º–∞–ª–∏–∏:**
   - –ö–∞–∂–¥–∞—è –∞–Ω–æ–º–∞–ª–∏—è –º–∏–Ω—É—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É–Ω–∫—Ç–æ–≤

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å—ã –∏ —Ä–∞–±–æ—á–∏–µ –ø–æ—Ç–æ–∫–∏

### –†–∞–±–æ—á–∏–π –ø–æ—Ç–æ–∫ 1: –ò–º–ø–æ—Ä—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å –∞–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–µ–π

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç CSV/Excel —Ñ–∞–π–ª
   ‚Üì
2. –°–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ (file_ingest.py)
   ‚Üì
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
   - ExpenseAutoCategorizer.predict_category(description)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é
   ‚Üì
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
   ‚Üì
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
   ‚Üì
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –ø–∞–º—è—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### –†–∞–±–æ—á–∏–π –ø–æ—Ç–æ–∫ 2: –ê–Ω–∞–ª–∏–∑ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

```
1. API –∑–∞–ø—Ä–æ—Å: GET /api/ai-insights/
   ‚Üì
2. –°–∏—Å—Ç–µ–º–∞ –≤—ã–∑—ã–≤–∞–µ—Ç analyze_finances(user)
   ‚Üì
3. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:
   - aggregate_transactions_by_month()
   - _detect_expense_anomalies()
   - _analyze_trends()
   ‚Üì
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:
   - build_recommendations() (–ø—Ä–∞–≤–∏–ª–∞)
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç LLM (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
   ‚Üì
5. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (Markdown —Ç–∞–±–ª–∏—Ü–∞ + —Ç–µ–∫—Å—Ç)
   ‚Üì
6. –í–æ–∑–≤—Ä–∞—Ç JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
```

### –†–∞–±–æ—á–∏–π –ø–æ—Ç–æ–∫ 3: –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã

```
1. API –∑–∞–ø—Ä–æ—Å: GET /api/forecast/
   ‚Üì
2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚Üì
3. forecast_next_month_profit() ‚Üí –ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏–±—ã–ª–∏
   ‚Üì
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –ø–∞–º—è—Ç—å
   ‚Üì
5. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

1. API –∑–∞–ø—Ä–æ—Å: POST /api/documents/generate/
   ‚Üì
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (type, client, total, details)
   ‚Üì
3. generate_document_text() ‚Üí —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞
   ‚Üì
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –º–æ–¥–µ–ª–∏ Document
   ‚Üì
5. –í–æ–∑–≤—Ä–∞—Ç —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

---

## üîê –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM (Large Language Models)

**–§–∞–π–ª:** `core/llm.py` (~800 —Å—Ç—Ä–æ–∫)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM —á–µ—Ä–µ–∑ OpenRouter –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π Ollama.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏:

1. **Cloud (OpenRouter API):**
   - GPT-4
   - GPT-3.5-turbo
   - Claude 3
   - Gemini Pro
   - Qwen
   - Mistral
   - –ò –¥—Ä—É–≥–∏–µ

2. **Local (Ollama):**
   - llama2
   - mistral
   - neural-chat
   - –ò –¥—Ä—É–≥–∏–µ

### –û—Å–Ω–æ–≤–Ω–æ–π API:

```python
from core.llm import get_llm_response

response = get_llm_response(
    user=user,
    prompt="–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–∏ —Ä–∞—Å—Ö–æ–¥—ã",
    system_prompt="–¢—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫",
    use_memory=True,
    anonymize=True
)
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä LLM:**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: OpenRouter
   - –ï—Å–ª–∏ `local_mode_only=True`: Ollama
   - Fallback –Ω–∞ –º–µ—Å—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –µ—Å–ª–∏ –≤—Å–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ

2. **–ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–æ–º–µ—Ä–∞ —Å—á–µ—Ç–æ–≤, —Ä–µ–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `core.utils.anonymizer.py`

3. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é:**
   - –•—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ `UserProfile.financial_memory` (JSON)
   - –ü–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç —Å—Ç–∞—Ä—É—é –∏—Å—Ç–æ—Ä–∏—é

4. **–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞:**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—å ChatSession/ChatMessage
   - –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–∑–∂–µ
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

**–§–∞–π–ª:** `core/utils/encryption.py`

```python
class AESEncryption:
    """AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞"""
    
    @staticmethod
    def encrypt_data(data: dict, password: str) -> str:
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ JSON, —à–∏—Ñ—Ä—É–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64
        
    @staticmethod
    def decrypt_data(encrypted: str, password: str) -> dict:
        # –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
```

### –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥ LLM:

**–§–∞–π–ª:** `core/utils/anonymizer.py`

```python
def anonymize_for_llm(text: str) -> str:
    """
    –ó–∞–º–µ–Ω—è–µ—Ç:
    - –ù–æ–º–µ—Ä–∞ —Å—á–µ—Ç–æ–≤ ‚Üí [ACCOUNT]
    - Email ‚Üí [EMAIL]
    - –ò–º–µ–Ω–∞ –∫–æ–º–ø–∞–Ω–∏–π ‚Üí [COMPANY]
    - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—É–º–º—ã ‚Üí [AMOUNT]
    - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã ‚Üí [DATE]
    """
```

---

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Django

### Models:

```python
class Income(models.Model):
    user = ForeignKey(User)
    amount = FloatField()
    date = DateField()
    category = CharField()
    description = TextField()
    source_file = ForeignKey('UploadedFile', null=True, blank=True)
    encrypted_data = TextField(blank=True, null=True)
    is_encrypted = BooleanField(default=False)
    tags = ManyToManyField(Tag)

class Expense(models.Model):
    # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Income
    
class UserProfile(models.Model):
    user = OneToOneField(User)
    local_mode_only = BooleanField()
    encryption_enabled = BooleanField()
    financial_memory = JSONField()
    success_cases = JSONField()
    auto_clear_file_on_import = BooleanField()
    auto_remove_duplicates = BooleanField()
```

### API Endpoints:

```python
# core/urls.py

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
GET  /api/ai-insights/           ‚Üí analyze_finances()
GET  /api/anomalies/             ‚Üí detect_anomalies()

# –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
GET  /api/forecast/              ‚Üí forecast_next_month_profit()

# –î–æ–∫—É–º–µ–Ω—Ç—ã
POST /api/documents/generate/    ‚Üí generate_document_text()

# –ò–º–ø–æ—Ä—Ç —Ñ–∞–π–ª–æ–≤
POST /api/files/upload/          ‚Üí file_ingest()

# Chat —Å AI
POST /api/chat/                  ‚Üí chat_with_ai()
GET  /api/chat/history/          ‚Üí get_chat_history()

# –≠–∫—Å–ø–æ—Ä—Ç
GET  /api/export/csv/            ‚Üí export_to_csv()
GET  /api/export/docx/           ‚Üí export_to_docx()
GET  /api/export/pdf/            ‚Üí export_to_pdf()
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–∞

```python
from core.ml.predictor import ExpenseAutoCategorizer

categorizer = ExpenseAutoCategorizer()

# –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ CSV —Å —Ä–∞—Å—Ö–æ–¥–∞–º–∏:
for row in csv_data:
    if not row['category']:
        category = categorizer.predict_category(row['description'])
        row['category'] = category
    
    expense = Expense(
        user=user,
        amount=row['amount'],
        date=row['date'],
        category=category,
        description=row['description']
    )
    expense.save()
```

### –ü—Ä–∏–º–µ—Ä 2: –ê–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

```python
from core.utils.analytics import analyze_finances

user = request.user
analysis = analyze_finances(user)

print("–ú–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
print(analysis['monthly_summary'])  # Markdown —Ç–∞–±–ª–∏—Ü–∞

print("\n–ê–Ω–æ–º–∞–ª–∏–∏:")
for anomaly in analysis['anomalies']:
    print(f"  - {anomaly['amount']} –Ω–∞ {anomaly['category']} ({anomaly['date']})")

print("\n–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
for rec in analysis['recommendations']:
    print(f"  - {rec}")

print("\n–û—Ü–µ–Ω–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è: {}/100".format(analysis['health_score']))
```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏

```python
from core.ml.forecast import forecast_next_month_profit

incomes = Income.objects.filter(user=user)
expenses = Expense.objects.filter(user=user)

forecast = forecast_next_month_profit(incomes, expenses)

if forecast:
    print(f"–ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–∏–±—ã–ª–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü: {forecast:,.2f} RUB")
else:
    print("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞")
```

### –ü—Ä–∏–º–µ—Ä 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞

```python
from core.ml.document_generator import generate_document_text

params = {
    'client': '–û–û–û –†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞',
    'total': '25000',
    'details': '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø–æ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏'
}

invoice_text = generate_document_text('invoice', params)

document = Document(
    user=user,
    doc_type='invoice',
    params=params,
    generated_text=invoice_text
)
document.save()
```

### –ü—Ä–∏–º–µ—Ä 5: Chat API —Å AI

```python
import json
from core.llm import get_llm_response

response = get_llm_response(
    user=user,
    prompt="–ö–∞–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã —è –¥–æ–ª–∂–µ–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å?",
    system_prompt="–¢—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Å –æ–ø—ã—Ç–æ–º –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞—Ç—Ä–∞—Ç.",
    use_memory=True,
    anonymize=True
)

print(response)  # "–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö, —è –≤–∏–∂—É –≤—ã—Å–æ–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥..."
```

---

## üöÄ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 1. –£–ª—É—á—à–µ–Ω–∏–µ –∞–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏:

```python
# train_classifier.py - –ø–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
data = [
    ('–û–ø–ª–∞—Ç–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞', 'utilities'),
    ('–ó–∞–∫—É–ø–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', 'equipment'),
    ('–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–æ—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã', 'travel'),
    ...
]
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π:

```python
# document_generator.py - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω—É—é –º–æ–¥–µ–ª—å
_MODEL_ID = 'sberbank-ai/rugpt3small_based_on_gpt2'  # –≤–º–µ—Å—Ç–æ tiny-gpt2
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:

```python
# recommender.py
def build_recommendations(incomes_qs, expenses_qs):
    recs = []
    
    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞...
    
    # –ù–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ: –î–µ—Ñ–∏—Ü–∏—Ç –µ—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥—ã > –¥–æ—Ö–æ–¥–æ–≤
    total_income = incomes_qs.aggregate(total=Sum('amount'))['total'] or 0
    total_expense = expenses_qs.aggregate(total=Sum('amount'))['total'] or 0
    
    if total_expense > total_income:
        recs.append("‚ö†Ô∏è –î–µ—Ñ–∏—Ü–∏—Ç! –†–∞—Å—Ö–æ–¥—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç –¥–æ—Ö–æ–¥—ã.")
    
    return recs if recs else ["–§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ."]
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö API –¥–ª—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç, —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
import requests

def get_exchange_rates():
    response = requests.get('https://api.exchangerate-api.com/v4/latest/RUB')
    return response.json()

# –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Å —É—á—ë—Ç–æ–º –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç
```

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

ML —Å–∏—Å—Ç–µ–º–∞ SB Finance –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –º–æ–¥—É–ª—å–Ω–æ –∏ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ**: –∞–≤—Ç–æ–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è (sklearn), –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ (scikit-learn)
- **–ê–Ω–∞–ª–∏–∑**: –∞–Ω–æ–º–∞–ª–∏–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞), —Ç—Ä–µ–Ω–¥—ã (–∞–≥—Ä–µ–≥–∞—Ü–∏—è), –∑–¥–æ—Ä–æ–≤—å–µ (–º–µ—Ç—Ä–∏–∫–∏)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ø—Ä–∞–≤–∏–ª–∞, LLM-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –∏—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–æ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç—ã**: —à–∞–±–ª–æ–Ω—ã, Hugging Face –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è, –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Django —á–µ—Ä–µ–∑ models, API views –∏ background tasks, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –º–æ—â–Ω—ã–π –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π AI.

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2024-12-16  
**–í–µ—Ç–∫–∞ Git:** docs-ml-full-description-52x
